angular.module("angular.prime").directive("puiDropdown",["$parse",function(){return{restrict:"A",require:"?ngModel",compile:function(){return function(a,b,c,e){function f(){var a=void 0,a=d.editable?b.puidropdown("getCustomInputVal"):d.useLabel?b.puidropdown("getSelectedLabel"):b.puidropdown("getSelectedValue");e.$setViewValue(a)}if(c.ngOptions){e.$render();var g=b.children()[0];""===g.text&&"?"===g.value&&b[0].removeChild(g)}var d=a.$eval(c.puiDropdown)||{};d.editable=void 0!==d.editable?d.editable:
!1;d.editable&&(d.useLabel=!0);d.useLabel=void 0!==d.useLabel?d.useLabel:!1;d.filter=void 0!==d.filter?d.filter:!1;d.effect=d.effect||"fade";d.effectSpeed=d.effectSpeed||"normal";d.filterMatchMode=d.filterMatchMode||"startsWith";d.caseSensitiveFilter=void 0!==d.caseSensitiveFilter?d.caseSensitiveFilter:!1;d.scrollHeight=d.scrollHeight||200;$(function(){b.puidropdown({editable:d.editable,filter:d.filter,effect:d.effect,effectSpeed:d.effectSpeed,filterMatchMode:d.filterMatchMode,caseSensitiveFilter:d.caseSensitiveFilter,
filterFunction:d.filterFunction,scrollHeight:d.scrollHeight})});e.$render=function(){d.useLabel?b.puidropdown("selectValue",e.$viewValue):b.puidropdown("selectIndex",e.$viewValue)};b.bind("puidropdownchange",function(){a.safeApply(f());if(d.callback){var c=b.puidropdown("getSelectedValue"),e=b.puidropdown("getCustomInputVal");d.callback(c,e)}});f();c.ngDisabled&&a.$watch(c.ngDisabled,function(a){a===false?$(function(){b.puidropdown("enable")}):$(function(){b.puidropdown("disable")})})}}}}]);$(function(){$.widget("primeui.puidropdown",{options:{effect:"fade",effectSpeed:"normal",filter:!1,filterMatchMode:"startsWith",caseSensitiveFilter:!1,filterFunction:null,source:null,content:null,scrollHeight:200},_create:function(){if(this.options.source)for(var a=0;a<this.options.source.length;a++){var b=this.options.source[a];b.label?this.element.append('<option value="'+b.value+'">'+b.label+"</option>"):this.element.append('<option value="'+b+'">'+b+"</option>")}this.element.wrap('<div class="pui-dropdown ui-widget ui-state-default ui-corner-all ui-helper-clearfix" />').wrap('<div class="ui-helper-hidden-accessible" />');
this.container=this.element.closest(".pui-dropdown");this.focusElementContainer=$('<div class="ui-helper-hidden-accessible"><input type="text" /></div>').appendTo(this.container);this.focusElement=this.focusElementContainer.children("input");this.label=this.options.editable?$('<input type="text" class="pui-dropdown-label pui-inputtext ui-corner-all"">'):$('<label class="pui-dropdown-label pui-inputtext ui-corner-all"/>');this.label.appendTo(this.container);this.menuIcon=$('<div class="pui-dropdown-trigger ui-state-default ui-corner-right"><span class="ui-icon ui-icon-triangle-1-s"></span></div>').appendTo(this.container);
this.panel=$('<div class="pui-dropdown-panel ui-widget-content ui-corner-all ui-helper-hidden pui-shadow" />').appendTo(document.body);this.itemsWrapper=$('<div class="pui-dropdown-items-wrapper" />').appendTo(this.panel);this.itemsContainer=$('<ul class="pui-dropdown-items pui-dropdown-list ui-widget-content ui-widget ui-corner-all ui-helper-reset"></ul>').appendTo(this.itemsWrapper);this.disabled=this.element.prop("disabled");this.choices=this.element.children("option");this.optGroupsSize=this.itemsContainer.children("li.puiselectonemenu-item-group").length;
this.options.filter&&(this.filterContainer=$('<div class="pui-dropdown-filter-container" />').prependTo(this.panel),this.filterInput=$('<input type="text" autocomplete="off" class="pui-dropdown-filter pui-inputtext ui-widget ui-state-default ui-corner-all" />').appendTo(this.filterContainer),this.filterContainer.append('<span class="ui-icon ui-icon-search"></span>'));this._generateItems();var c=this,a=this.choices.filter(":selected");this.choices.filter(":disabled").each(function(){c.items.eq($(this).index()).addClass("ui-state-disabled")});
this.triggers=this.options.editable?this.menuIcon:this.container.children(".pui-dropdown-trigger, .pui-dropdown-label");this.options.editable?(b=this.label.val(),b===a.text()?this._highlightItem(this.items.eq(a.index())):(this.items.eq(0).addClass("ui-state-highlight"),this.customInput=!0,this.customInputVal=b)):this._highlightItem(this.items.eq(a.index()));this.disabled||(this._bindEvents(),this._bindConstantEvents());this._initDimensions()},_generateItems:function(){for(var a=0;a<this.choices.length;a++){var b=
this.choices.eq(a).text(),c=this.options.content?this.options.content.call(this,this.options.source[a]):b;this.itemsContainer.append('<li data-label="'+b+'" class="pui-dropdown-item pui-dropdown-list-item ui-corner-all">'+c+"</li>")}this.items=this.itemsContainer.children(".pui-dropdown-item")},_bindEvents:function(){var a=this;this.items.filter(":not(.ui-state-disabled)").on("mouseover.puidropdown",function(){$(this).hasClass("ui-state-highlight")||$(this).addClass("ui-state-hover")}).on("mouseout.puidropdown",
function(){$(this).removeClass("ui-state-hover")}).on("click.puidropdown",function(){a._selectItem($(this))});this.triggers.on("mouseenter.puidropdown",function(){a.container.hasClass("ui-state-focus")||(a.container.addClass("ui-state-hover"),a.menuIcon.addClass("ui-state-hover"))}).on("mouseleave.puidropdown",function(){a.container.removeClass("ui-state-hover");a.menuIcon.removeClass("ui-state-hover")}).on("click.puidropdown",function(b){a.panel.is(":hidden")?a._show():(a._hide(),a._revert());a.container.removeClass("ui-state-hover");
a.menuIcon.removeClass("ui-state-hover");a.focusElement.trigger("focus.puidropdown");b.preventDefault()});this.focusElement.on("focus.puidropdown",function(){a.container.addClass("ui-state-focus");a.menuIcon.addClass("ui-state-focus")}).on("blur.puidropdown",function(){a.container.removeClass("ui-state-focus");a.menuIcon.removeClass("ui-state-focus")});if(this.options.editable)this.label.on("change.pui-dropdown",function(){a.customInput=!0;a.customInputVal=$(this).val();a._triggerChange(!0);a.items.filter(".ui-state-highlight").removeClass("ui-state-highlight");
a.items.eq(0).addClass("ui-state-highlight")});this._bindKeyEvents();this.options.filter&&(this._setupFilterMatcher(),this.filterInput.puiinputtext(),this.filterInput.on("keyup.pui-dropdown",function(){a._filter($(this).val())}))},_bindConstantEvents:function(){var a=this;$(document.body).bind("mousedown.pui-dropdown",function(b){if(!a.panel.is(":hidden")){var c=a.panel.offset();if(!(b.target===a.label.get(0)||b.target===a.menuIcon.get(0)||b.target===a.menuIcon.children().get(0)))if(b.pageX<c.left||
b.pageX>c.left+a.panel.width()||b.pageY<c.top||b.pageY>c.top+a.panel.height())a._hide(),a._revert()}});this.resizeNS="resize."+this.id;this._unbindResize();this._bindResize()},_bindKeyEvents:function(){var a=this;this.focusElement.on("keydown.puiselectonemenu",function(b){var c=$.ui.keyCode,e=b.which;switch(e){case c.UP:case c.LEFT:c=a._getActiveItem();c=c.prevAll(":not(.ui-state-disabled,.ui-selectonemenu-item-group):first");1==c.length&&(a.panel.is(":hidden")?a._selectItem(c):(a._highlightItem(c),
PUI.scrollInView(a.itemsWrapper,c)));b.preventDefault();break;case c.DOWN:case c.RIGHT:c=a._getActiveItem();c=c.nextAll(":not(.ui-state-disabled,.ui-selectonemenu-item-group):first");1==c.length&&(a.panel.is(":hidden")?b.altKey?a._show():a._selectItem(c):(a._highlightItem(c),PUI.scrollInView(a.itemsWrapper,c)));b.preventDefault();break;case c.ENTER:case c.NUMPAD_ENTER:a.panel.is(":hidden")?a._show():a._selectItem(a._getActiveItem());b.preventDefault();break;case c.TAB:a.panel.is(":visible")&&(a._revert(),
a._hide());break;case c.ESCAPE:a.panel.is(":visible")&&(a._revert(),a._hide());break;default:b=String.fromCharCode(96<=e&&105>=e?e-48:e),c=a.items.filter(".ui-state-highlight"),(e=a._search(b,c.index()+1,a.options.length))||(e=a._search(b,0,c.index())),e&&(a.panel.is(":hidden")?a._selectItem(e):(a._highlightItem(e),PUI.scrollInView(a.itemsWrapper,e)))}})},_initDimensions:function(){var a=this.element.attr("style");(!a||-1==a.indexOf("width"))&&this.container.width(this.element.outerWidth(!0)+5);this.label.width(this.container.width()-
this.menuIcon.width());a=this.container.innerWidth();this.panel.outerWidth()<a&&this.panel.width(a);this.element.parent().addClass("ui-helper-hidden").removeClass("ui-helper-hidden-accessible");this.options.scrollHeight&&this.panel.outerHeight()>this.options.scrollHeight&&this.itemsWrapper.height(this.options.scrollHeight)},_selectItem:function(a,b){var c=this.choices.eq(this._resolveItemIndex(a)),e=this.choices.filter(":selected"),e=c.val()==e.val(),f=null;if(f=this.options.editable?!e||c.text()!=
this.label.val():!e)this._highlightItem(a),this.element.val(c.val()),this.options.editable&&(this.customInput=!1),this._triggerChange();b||this.focusElement.trigger("focus.puidropdown");this.panel.is(":visible")&&this._hide()},_highlightItem:function(a){this.items.filter(".ui-state-highlight").removeClass("ui-state-highlight");a.addClass("ui-state-highlight");this._setLabel(a.data("label"))},_triggerChange:function(a){this._trigger("change");a||(this.value=this.choices.filter(":selected").val())},
_resolveItemIndex:function(a){return 0===this.optGroupsSize?a.index():a.index()-a.prevAll("li.pui-dropdown-item-group").length},_setLabel:function(a){this.options.editable?this.label.val(a):"&nbsp;"===a?this.label.html("&nbsp;"):this.label.text(a)},_bindResize:function(){var a=this;$(window).bind(this.resizeNS,function(){a.panel.is(":visible")&&a._alignPanel()})},_unbindResize:function(){$(window).unbind(this.resizeNS)},_unbindEvents:function(){this.items.off();this.triggers.off();this.label.off()},
_alignPanel:function(){this.panel.css({left:"",top:""}).position({my:"left top",at:"left bottom",of:this.container})},_show:function(){this._alignPanel();this.panel.css("z-index",++PUI.zindex);"none"!=this.options.effect?this.panel.show(this.options.effect,{},this.options.effectSpeed):this.panel.show();this.preShowValue=this.choices.filter(":selected")},_hide:function(){this.panel.hide()},_revert:function(){this.options.editable&&this.customInput?(this._setLabel(this.customInputVal),this.items.filter(".ui-state-active").removeClass("ui-state-active"),
this.items.eq(0).addClass("ui-state-active")):this._highlightItem(this.items.eq(this.preShowValue.index()))},_getActiveItem:function(){return this.items.filter(".ui-state-highlight")},_setupFilterMatcher:function(){this.filterMatchers={startsWith:this._startsWithFilter,contains:this._containsFilter,endsWith:this._endsWithFilter,custom:this.options.filterFunction};this.filterMatcher=this.filterMatchers[this.options.filterMatchMode]},_startsWithFilter:function(a,b){return 0===a.indexOf(b)},_containsFilter:function(a,
b){return-1!==a.indexOf(b)},_endsWithFilter:function(a,b){return-1!==a.indexOf(b,a.length-b.length)},_filter:function(a){this.initialHeight=this.initialHeight||this.itemsWrapper.height();a=this.options.caseSensitiveFilter?$.trim(a):$.trim(a).toLowerCase();if(""===a)this.items.filter(":hidden").show();else for(var b=0;b<this.choices.length;b++){var c=this.choices.eq(b),c=this.options.caseSensitiveFilter?c.text():c.text().toLowerCase(),e=this.items.eq(b);this.filterMatcher(c,a)?e.show():e.hide()}this.itemsContainer.height()<
this.initialHeight?this.itemsWrapper.css("height","auto"):this.itemsWrapper.height(this.initialHeight)},_search:function(a,b,c){for(;b<c;b++)if(0==this.choices.eq(b).text().indexOf(a))return this.items.eq(b);return null},getSelectedValue:function(){return this.element.val()},getSelectedLabel:function(){return this.choices.filter(":selected").text()},selectValue:function(a){a=this.choices.filter('[value="'+a+'"]');this._selectItem(this.items.eq(a.index()),!0)},getCustomInputVal:function(){return!0===
this.customInput?this.customInputVal:this.getSelectedLabel()},disable:function(){this._unbindEvents();this.label.addClass("ui-state-disabled");this.menuIcon.addClass("ui-state-disabled")},enable:function(){this._bindEvents();this.label.removeClass("ui-state-disabled");this.menuIcon.removeClass("ui-state-disabled")},selectIndex:function(a){this._selectItem(this.items.eq(a),!0)}})});