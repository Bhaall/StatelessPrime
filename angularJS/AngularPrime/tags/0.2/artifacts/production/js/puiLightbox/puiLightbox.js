angular.module("angular.prime").directive("puiLightbox",function(){return{restrict:"A",priority:5,compile:function(){return function(a,b,c){var d=a.$eval(c.puiLightbox)||{};d.iframe="A"===b[0].nodeName;$(function(){b.puilightbox({iframe:d.iframe,iframeWidth:d.iframeWidth,iframeHeight:d.iframeHeight})})}}}}).directive("puiLightboxItem",function(){return{restrict:"A",priority:10,compile:function(a,b){var c=a.parent().data("puiLightboxType");void 0===c&&(c=a.parent().children("[pui-lightbox-item]"),
c=0!=c.length?1<c.length?"images":"inline":void 0,a.parent().data("puiLightboxType",c));"inline"===c&&(a.addClass("ui-helper-hidden"),a.before('<a class="group" href="#">'+b.title+"</a>  "),a.removeAttr("pui-lightbox-item"));if("images"===c){var c=a.children("img"),d=a.attr("title"),e=a.attr("src"),f=c.attr("src"),g=c.attr("alt")||c.attr("title");$(function(){a.children().attr("src",e);a.children().attr("alt",d);a.children().attr("title",d);a.children().wrap('<a href="'+f+'" title="'+g+'">');a.replaceWith(a.html())})}}}});$(function(){$.widget("primeui.puilightbox",{options:{iframeWidth:640,iframeHeight:480,iframe:!1},_create:function(){this.options.mode=this.options.iframe?"iframe":1==this.element.children("div").length?"inline":"image";this.panel=$('<div class="pui-lightbox ui-widget ui-helper-hidden ui-corner-all pui-shadow"><div class="pui-lightbox-content-wrapper"><a class="ui-state-default pui-lightbox-nav-left ui-corner-right ui-helper-hidden"><span class="ui-icon ui-icon-carat-1-w">go</span></a><div class="pui-lightbox-content ui-corner-all"></div><a class="ui-state-default pui-lightbox-nav-right ui-corner-left ui-helper-hidden"><span class="ui-icon ui-icon-carat-1-e">go</span></a></div><div class="pui-lightbox-caption ui-widget-header"><span class="pui-lightbox-caption-text"></span><a class="pui-lightbox-close ui-corner-all" href="#"><span class="ui-icon ui-icon-closethick"></span></a><div style="clear:both" /></div></div>').appendTo(document.body);
this.contentWrapper=this.panel.children(".pui-lightbox-content-wrapper");this.content=this.contentWrapper.children(".pui-lightbox-content");this.caption=this.panel.children(".pui-lightbox-caption");this.captionText=this.caption.children(".pui-lightbox-caption-text");this.closeIcon=this.caption.children(".pui-lightbox-close");"image"===this.options.mode?this._setupImaging():"inline"===this.options.mode?this._setupInline():"iframe"===this.options.mode&&this._setupIframe();this._bindCommonEvents();this.links.data("puilightbox-trigger",
!0).find("*").data("puilightbox-trigger",!0);this.closeIcon.data("puilightbox-trigger",!0).find("*").data("puilightbox-trigger",!0)},_bindCommonEvents:function(){var a=this;this.closeIcon.hover(function(){$(this).toggleClass("ui-state-hover")}).click(function(b){a.hide();b.preventDefault()});$(document.body).bind("click.pui-lightbox",function(b){if(!a.isHidden()&&!$(b.target).data("puilightbox-trigger")){var c=a.panel.offset();(b.pageX<c.left||b.pageX>c.left+a.panel.width()||b.pageY<c.top||b.pageY>
c.top+a.panel.height())&&a.hide()}});$(window).resize(function(){a.isHidden()||$(document.body).children(".ui-widget-overlay").css({width:$(document).width(),height:$(document).height()})})},_setupImaging:function(){var a=this;this.links=this.element.children("a");this.content.append('<img class="ui-helper-hidden"></img>');this.imageDisplay=this.content.children("img");this.navigators=this.contentWrapper.children("a");this.imageDisplay.load(function(){var b=$(this);a._scaleImage(b);var c=(a.panel.width()-
b.width())/2,d=(a.panel.height()-b.height())/2;a.content.removeClass("pui-lightbox-loading").animate({width:b.width(),height:b.height()},500,function(){b.fadeIn();a._showNavigators();a.caption.slideDown()});a.panel.animate({left:"+="+c,top:"+="+d},500)});this.navigators.hover(function(){$(this).toggleClass("ui-state-hover")}).click(function(b){var c=$(this);a._hideNavigators();c=c.hasClass("pui-lightbox-nav-left")?0==a.current?a.links.length-1:a.current-1:a.current==a.links.length-1?0:a.current+1;
a.links.eq(c).trigger("click");b.preventDefault()});this.links.click(function(b){var c=$(this);a.isHidden()?(a.content.addClass("pui-lightbox-loading").width(32).height(32),a.show()):(a.imageDisplay.fadeOut(function(){$(this).css({width:"auto",height:"auto"});a.content.addClass("pui-lightbox-loading")}),a.caption.slideUp());setTimeout(function(){a.imageDisplay.attr("src",c.attr("href"));a.current=c.index();var b=c.attr("title");b&&a.captionText.html(b)},1E3);b.preventDefault()})},_scaleImage:function(a){var b=
$(window),c=b.width(),b=b.height(),d=a.width(),e=a.height(),f=e/d;d>=c&&1>=f?(d=0.75*c,e=d*f):e>=b&&(e=0.75*b,d=e/f);a.css({width:d+"px",height:e+"px"})},_setupInline:function(){this.links=this.element.children("a");this.inline=this.element.children("div").addClass("pui-lightbox-inline");this.inline.appendTo(this.content).show();var a=this;this.links.click(function(b){a.show();var c=$(this).attr("title");c&&(a.captionText.html(c),a.caption.slideDown());b.preventDefault()})},_setupIframe:function(){var a=
this;this.links=this.element;this.iframe=$('<iframe frameborder="0" style="width:'+this.options.iframeWidth+"px;height:"+this.options.iframeHeight+'px;border:0 none; display: block;"></iframe>').appendTo(this.content);this.options.iframeTitle&&this.iframe.attr("title",this.options.iframeTitle);this.element.click(function(b){a.iframeLoaded?a.show():(a.content.addClass("pui-lightbox-loading").css({width:a.options.iframeWidth,height:a.options.iframeHeight}),a.show(),a.iframe.on("load",function(){a.iframeLoaded=
!0;a.content.removeClass("pui-lightbox-loading")}).attr("src",a.element.attr("href")));var c=a.element.attr("title");c&&(a.caption.html(c),a.caption.slideDown());b.preventDefault()})},show:function(){this.center();this.panel.css("z-index",++PUI.zindex).show();this.modality||this._enableModality();this._trigger("show")},hide:function(){this.panel.fadeOut();this._disableModality();this.caption.hide();"image"===this.options.mode&&(this.imageDisplay.hide().attr("src","").removeAttr("style"),this._hideNavigators());
this._trigger("hide")},center:function(){var a=$(window),b=a.width()/2-this.panel.width()/2,a=a.height()/2-this.panel.height()/2;this.panel.css({left:b,top:a})},_enableModality:function(){this.modality=$('<div class="ui-widget-overlay"></div>').css({width:$(document).width(),height:$(document).height(),"z-index":this.panel.css("z-index")-1}).appendTo(document.body)},_disableModality:function(){this.modality.remove();this.modality=null},_showNavigators:function(){this.navigators.zIndex(this.imageDisplay.zIndex()+
1).show()},_hideNavigators:function(){this.navigators.hide()},isHidden:function(){return this.panel.is(":hidden")},showURL:function(a){a.width&&this.iframe.attr("width",a.width);a.height&&this.iframe.attr("height",a.height);this.iframe.attr("src",a.src);this.show()}})});